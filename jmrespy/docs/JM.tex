\documentclass[11pt, oneside]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
%\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{amssymb}
\pagenumbering{gobble}
\usepackage{makecell}
\providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

%SetFonts

%SetFonts


\title{Joint models for longitudinal and time-to-event data with shared random effects with jmsrepy library}
%\author{The Author}
\date{}							% Activate to display a given date or no date

\begin{document}
\maketitle
%\section{}
%\subsection{}









%Preamble paragraph
\section{Preamble}\label{preamble}

jmsrepy library is a partial adaptation of Dimitris Rizopoulos's JM R package.
The aim of this library isn't today to be an exhaustive adaptation of JM R package,
but to respond needs of our specific applied clinical project. In consequence, the library reproduce
today only a part of what R package do. It will be improved in future with some functions which already
exists in R package and also some features not handled by R package.

jmsrepy estimate parameters of a joint model for longitudinal and time-to-event data  with shared random effects
from a mixed linear model and a proportional risk model. jmsrepy also compute probability to survive after a
future time.









%Presentation of model
\section{Mathematical formulation}\label{maths}

Joint models for longitudinal and time-to-event data  with shared random effects here abbreviated
\textbf{joint models} are used to simultaneously model instantaneous hazard and a longitudinal marker
taking into account the correlation between longitudinal marker and instantaneous hazard. In practice
we use joint models to estimate an instantaneous hazard using both baseline and longitudinal covariates.
Then, joint model combine a proportional risk model which models instantaneous hazard and a mixed linear model
which models the longitudinal marker. Instantaneous hazard and longitudinal process are linked by a function in
instantaneous hazard part of joint model. This function can have many formulations, but it only depends on mixed
linear model's random effects.

If we have \(N\) groups in our mixed linear model, the joint model is formulated as following for the \(i^{th}\) group at time  \(t\) :
 
 \[
  \left\{
    \begin{array}{l}
      h_i(t) = h_0(t) \exp(\gamma W_i + g(m_i(t-u), \alpha, b_i))\\
      Y_i(t) = m_i(t) + \epsilon_i(t) = X_i \beta + Z_i b_i + \epsilon_i(t) \\
       b_i \sim N(0,D), \epsilon_i(t) \sim N(0,\sigma^2)
    \end{array}
  \right.
\]
 
Where the different terms denotes :
 
\begin{itemize}
\tightlist
\item
  \(X_i\) : Design matrix of covariates associated with mixed linear model fixed
  effects to modeling longitudinal marker
\item
  \(\beta\) : Vector of estimated linear model fixed effects to
  modeling longitudinal marker
\item
  \(Z_i\) : Design matrix of covariates associated with mixed linear model random
  effects to modeling longitudinal marker (\(Z_i\) is a slice of  \(X_i\))
 \item
  \(b_i\) : Vector of estimated linear model random effects of the \(i^{th}\) group to 
  modeling longitudinal marker
\item
  \(\epsilon_i\) : Error vector
\item
  \(h_0(t)\) : Baseline risk at time \(t\)
\item
  \(W_i\) : Baseline covariates of group \(i\)
\item
  \(\gamma\) : Vector of regression coefficients associated with baseline covariates
\item
  \(g()\) : Link function between instantaneous hazard and longitudinal process
\item
  \(m_i(t)\) : Estimation of longitudinal marker at time \(t\)
\item
  \(u\) : Delay
\item
  \(\alpha\) : Vector of coefficients quantifying effect of longitudinal marker on \(h_i(t)\)    
\end{itemize}

As mentioned earlier, g() function can takes many formulations, see few examples bellow :
\begin{itemize}
\tightlist
\item
  \(h_i(t)\) depends on current value of longitudinal marker:
    \[
       g(m_i(t-u), \alpha, b_i) = \alpha m_i(t)
   \]
\item
  \(h_i(t)\) depends on evolution of longitudinal marker:
    \[
       g(m_i(t-u), \alpha, b_i) =  \alpha m_i'(t)
   \]
\item
  \(h_i(t)\) depends on current value and evolution of longitudinal marker:
    \[
       g(m_i(t-u), \alpha, b_i) = \alpha_1 m_i(t) + \alpha_2 m_i'(t)
   \]
\end{itemize}

%To finish with mathematical formulations of joint models, their joint likelihood is formulated as bellow :
%\[
%  L(\theta, Y, T, \delta) = \prod_i^N \int f(Y_i|b_i; \theta) h(T_i|b_i; \theta)^{\delta_i} S(T_i|b_i; \theta) f(b_i; \theta)dbi
%\]







%Arguments
\section{Input arguments}\label{input}

Following arguments are available for instantation of jm objet :

\begin{itemize}
\tightlist
\item
  \emph{lme\_object} : Instantiated and not fitted mixed linear model of longitudinal marker object. A \emph{statsmodels.regression.mixed\_linear\_model.MixedLM} object is expected.
\item
  \emph{lme\_object\_fitted} : Fitted mixed linear model of longitudinal marker object. A \emph{statsmodels.regression.mixed\_linear\_model.MixedLMResultsWrapper} object is expected.
item
  \emph{lme\_data} : Data used in mixed linear model of longitudinal marker object. In other terms, it corresponds to a pandas DataFrame which contains longitudinal marker and covariates used to model it.
\item
  \emph{lme\_formula} : R-type formula of longitudinal marker modeled by fixed effects. Takes this form : \emph{'long\_marker \(\sim\) X1 + X2'}.
\item
  \emph{lme\_re\_formula} : R-type formula of random effects. Takes this form : \emph{'\(\sim\) X1'}.
\item
  \emph{surv\_object} : Fitted proportional risk model object. A \emph{lifelines.CoxPHFitter} object is expected.
\item
  \emph{surv\_data} : Data used to fit proportional risk model object. In other terms, it corresponds to an array-like which contains baseline covariates, time of event or censor and vector which indicates if event appeared (0 : censor, 1 : event).
\item
  \emph{time\_var} : Column name in \emph{lme\_data} of variable which give time of each longitudinal measurement.
\item
  \emph{parametrization} : form of g() function (function which links longitudinal process and instantaneous hazard) :
  
  \begin{tabular}{|c|c|}
    \hline
    \emph{parametrization} & form of g()\\
    \hline
    'value' & \(g(m_i(t-u), \alpha, b_i) = \alpha m_i(t)\)\\
    'slope' & \(g(m_i(t-u), \alpha, b_i) =  \alpha m_i'(t)\)\\
    'both' & \(g(m_i(t-u), \alpha, b_i) = \alpha_1 m_i(t) + \alpha_2 m_i'(t)\)\\
    \hline
  \end{tabular}
  
\item
  \emph{derivForm} : A dictionary which specifies the derivative form of mixed linear model formula. This argument is required only when \emph{parametrization} is  \emph{'slope'} or  \emph{'both'}. The dictionary must contains following components :
 
  \begin{tabular}{|c|c|}
    \hline
    dict key & associated value\\
    \hline
    fixed & \thead{formula representing the derivative of the fixed-effects part \\ of the linear mixed model with respect to time}\\
    ind\_fixed & \thead{list indicating position in fixed-effects vector of fixed-effects \\ corresponding to the derivative}\\
    random & \thead{formula representing the derivative of the random-effects part \\ of the linear mixed model with respect to time}\\
    ind\_random & \thead{list indicating position in random-effects vector of random-effects \\ corresponding to the derivative}\\
    \hline
  \end{tabular}
  
   For example, if we have \emph{lme\_formula = 'long\_marker \(\sim\) 1 + X1'} and  \emph{lme\_re\_formula =\(\sim\) 1 + X1'}, then we will set  \emph{derivForm = dict(fixed='\(\sim\) 1', ind\_fixed = [1], random='\(\sim\) 1', ind\_random = [1])}
\item
  \emph{lag} : Delay in years
\item
  \emph{scale\_wb} : A numeric scalar denoting a fixed value for the scale parameter of the Weibull hazard. If the value is  \emph{None}, parameter is estimated.
\item
  \emph{init} : A dictionary in which user can specify initial values of models parameters. The dictionary can contains following components (they all are optional, user can set all initial vales, none initial values or a part of initial values) :
    
  \begin{tabular}{|c|c|}
    \hline
    dict key & associated value\\
    \hline
    betas & \thead{numpy array of linear mixed model fixed-effects parameters}\\
    d\_vc & \thead{numpy array of linear mixed model random-effects variance-covariance matrix}\\
    sigma & \thead{numpy array of the measurement of error standard deviation for the linear mixed effects model}\\
    gammas & \thead{numpy array of coefficients associated to baseline covariates in proportional risk model}\\
    alpha\_value &  \thead{numpy array of association parameter between \\ current value of longitudinal marker and instantaneous risk}\\
    alpha\_slope &  \thead{numpy array of association parameter between \\ evolution of longitudinal marker and instantaneous risk}\\
    sigma\_t & \thead{numpy array of scale parameter for the Weibull baseline risk function}\\
    \hline
  \end{tabular}

\end{itemize}








%Functions
\section{Functions}\label{functions}

Following functions are available after the object is instantiated

\begin{itemize}
\tightlist
\item
  \emph{fit} :  Function which fit the joint model on data
\item
  \emph{Summary} : Function which display the summary about fitted model informations (parameters value, log-likelihood, AIC etc)
\item
  \emph{Survfit} : Computes the probability at time \(s\) of surviving over time \(s+t\)
\end{itemize}









% References paragraphe
\section{References}\label{references}

Rizopoulos, D. (2012) \emph{Joint Models for Longitudinal and
Time-to-Event Data: with Applications in R.} Boca Raton: Chapman and
Hall/CRC.









\end{document}  