\documentclass[11pt, oneside]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
%\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{amssymb}
\pagenumbering{gobble}

\providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

%SetFonts

%SetFonts


\title{Prediction in Joint Models}
%\author{The Author}
\date{}							% Activate to display a given date or no date

\begin{document}
\maketitle
%\section{}
%\subsection{}









% Description paragraphe
\section{Description}\label{description}

This method is the Pyhton adaptation of R's survfitJM function. It
computes \(\pi(s+t | s)\) the probability at time s of surviving over
time s+t.

The probability for a subject \(i\) we know alive at time \(s\) to
survive over time \(s+t\) can be formulated by the following formula :

\[
    \pi_i(s+t | s) = \mathbb{P}(T_i^* \geq s+t | T_i^* > s, \mathcal{Y}_i(s); \theta)
\]

\[
= \int
        \frac
            {S_i(s+t | \mathcal{M}_i(s+t, b_i, \theta); \theta)}
            {S_i(s | \mathcal{M}_i(s, b_i, \theta); \theta)}
        * p(b_i | T_i^* > s, \mathcal{Y}_i(s); \theta) db_i
\]

Where the different terms denotes :

\begin{itemize}
\tightlist
\item
  \(\pi_i(x)\) : Probability for subject \(i\) to be alive at time \(x\)
\item
  \(s\) : time from when we know or we assume the subject is alive and
  from when we want to compute predictions of his future survival
  probabilities
\item
  \(t\) : time horizon from \(s\). The survival probability is given for
  time \(s+t\)
\item
  \(T_i^*\) : Random variable representing time when subject \(i\) dies
\item
  \(\mathcal{Y}_i(x)\) : Longitudinal measurement of subject \(i\)
  before time \(x\)
\item
  \(\theta\) : Parameters of joint model
\item
  \(S_i()\) : Survival function of subject \(i\)
\item
  \(\mathcal{M}_i()\) : Longitudinal history of subject \(i\),
  approximated by the linear mixed-effects model
\item
  \(b_i\) : Subject \(i\) random effects
\end{itemize}









% Usage paragraphe
\section{Usage}\label{usage}

\textbf{Call .Survfit()}

Ones your JointModel object is fitted, call
\emph{object.Survfit(new\_data, id\_var)}. \emph{new\_data} and
\emph{id\_var} are the only required arguments. The other arguments are
optional.

\textbf{Default values}

\begin{itemize}
\tightlist
\item
  \emph{surv\_times} = None
\item
  \emph{last\_time} = None
\item
  \emph{ci} = numpy.array({[}0.025, 0.975{]})
\item
  \emph{M} = 200
\item
  \emph{scale} = 1.6
\item
  \emph{simulate} = False
\end{itemize}









% Arguments paragraphe
\section{Arguments}\label{arguments}

\begin{itemize}
\item
  \emph{new\_data} : A pandas dataframe containing covariates
  used in both survival and linear mixed-effects models and longitudinal
  information ordered by increasing time for each subject.
  \emph{new\_data} must also containing a column that identifies different
  subjects. The names of covariates columns must be the same in
  \emph{new\_data} and in data used to fit the model. This dataframe is
  structured with one line for each longitudinal information. It could
  contains informations for several subjects. An exemple of a valid
  new\_data is provided just below

\begin{tabular}{|c|c|c|c|c|}
  \hline
  id\_subject & longitudinal var & Linear var 1 & Surv var 1 & Surv var 2 \\
   \hline
  1 & 221 & 12 & 58 & 0 \\
  1 & 257 & 24 & 58 & 0 \\
  1 & 284 & 36 & 58 & 0 \\
  2 & 112 & 14 & 65 & 1 \\
  2 & 191 & 26 & 65 & 1 \\
   \hline
\end{tabular}
\item
  \emph{id\_var} : Name of the column that identifies subjects in
  \emph{new\_data}.
\item
  \emph{surv\_times} : Numerical numpy array containing one or several times \(s+t\) of
  predictions. If surv\_times is None, \(s+t\) will be automaticaly generated.
\item
  \emph{last\_time} : \(s\) time from when we know or assume a subject
  is alive and from when we want to predict at time \(s+t\).
  \emph{last\_time} could be a character string or a numeric numpy
  array. If \emph{last\_time} is a string, the name of a column in
  \emph{new\_data} containing \(s\) time from which we predict is expected in input. If
  \emph{last\_time} is a numpy array, it must be a vector containing \(s\)
  time for each subject. If \emph{last\_time} is None, last longitudinal
  time in \emph{new\_data} will be taken as \emph{last\_time}.
  \textbf{Warning} each subject must have only one \(s\) time.
\item
  \emph{ci} : Numerical numpy array that specifies which quantiles to
  use for the computation of confidence interval for the predicted
  probabilities.
\item
  \emph{M} : Integer denoting how many loop are computed in Monte-Carlo
  method to estimate survival probabilities and compute a confidence
  interval.
\item
  \emph{scale} : A numeric scalar that controls the acceptance rate of
  the Metropolis-Hastings algorithm
\item
  \emph{simulate} : A boolean (True or False) that specifies if we
  estimate our survival probabilities using Monte-Carlo method or not.
  If \emph{simulate} is True, survival probabilities will be computed by
  a Monte-Carlo method and a confidence interval will be provided. If
  \emph{simulate} is False, probabilities will be computed without
  Monte-Carlo method and only ponctual estimation will be return.
\end{itemize}









% Details paragraphe
\section{Details}\label{details}

Estimation of \(\pi_i(s+t | s)\) computation method will depend on \emph{simulate} argument.

\paragraph{simulate = True}\label{simulate-true}

Estimation will be based on following Monte-Carlo procedure :

\textbf{Step1} : Simulate \(\theta^{(l)}\) vector of parameters values from a
multivariate normal distribution \(\mathcal{N}(\hat{\theta}, C(\hat{\theta}))\) 
where \(\hat{\theta}\) are the fitted joint model's parameters estimated by
MLE and \(C(\hat{\theta})\) their variance-covariance matrix.

\textbf{Step2} : Simulate \(b_i^{(l)}\) random effects of subject \(i\)
from \(b_i\) posterior distribution given \(T_i^* > s\),
\(\mathcal{Y}_i(s)\) and \(\theta^{(l)}\). This is achieved using a
Metropolis-Hastings algorithm with independent proposals from a properly
centered and scaled multivariate t distribution. The \emph{scale}
argument controls the acceptance rate for this algorithm.

\textbf{Step3} : Compute:

\[
\pi_i^{(l)}(s+t | s) = \frac
    {S_i(s+t | \mathcal{M}_i(s+t, b_i^{(l)}, \theta^{(l)}); \theta^{(l)})}
    {S_i(s | \mathcal{M}_i(s, b_i^{(l)}, \theta^{(l)}); \theta^{(l)})}
\]

Steps 1-3 are repeated \(l = 1,...,M\) times M is given by \emph{M}
argument of \emph{Survfit()} method.

\paragraph{simulate = False}\label{simulate-false}

Survival probabilities will be estimated by :

\[
\tilde{\pi_i}(s+t | s) = \frac
    {S_i(s+t | \mathcal{M}_i(s+t, \hat{b}_i^{(s)}, \hat{\theta}); \hat{\theta})}
    {S_i(s | \mathcal{M}_i(s, \hat{b}_i^{(s)}, \hat{\theta}); \hat{\theta})}
\]

Where the different terms denotes :

\begin{itemize}
\tightlist
\item
  \(\tilde{\pi_i}(x)\) : Estimated probability for subject \(i\) to be
  alive at time \(x\)
\item
  \(s\) : time from when we know or we assume the subject is alive and
  from when we want to compute predictions of his future survival
  probabilities
\item
  \(t\) : time horizon from \(s\). The survival probability is given for
  time \(s+t\)
\item
  \(\hat{\theta}\) : MLE of parameters of joint model
\item
  \(\hat{b}_i^{(s)}\) : Mode of the conditional distribution
  \(p(b_i | T_i^* > s, \mathcal{Y}_i(s); \hat{\theta})\)
\item
  \(S_i()\) : Survival function of subject \(i\)
\item
  \(\mathcal{M}_i()\) : Longitudinal history of subject \(i\),
  approximated by the linear mixed-effects model
\end{itemize}









% Value paragraphe
\section{Value}\label{value}

A dictionary containing a pandas dataframe for each group inputed in
\emph{new\_data}. Each dataframe provide estimated probabilities to
survive at each \(s+t\) times. If \emph{simulate} is True, the returned
dataframe will contain a summary of \emph{M} predictions containing :
mean, median, low and high boundaries of confidence interval. And if
\emph{simulate} is False, only ponctual estimation will be returned.









% References paragraphe
\section{References}\label{references}

Rizopoulos, D. (2012) \emph{Joint Models for Longitudinal and
Time-to-Event Data: with Applications in R.} Boca Raton: Chapman and
Hall/CRC.

\end{document}  